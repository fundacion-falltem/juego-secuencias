/* ======================================================
   FALLTEM — Secuencias (Simón) — v5.4
   - Columna central unificada
   - FABs tema-aware + compactos móvil
   - Modal usable (scroll interno + X + fondo bloqueado)
   - Accesibilidad: sr-only, reduced motion, contrast
   ====================================================== */

/* ===== Tokens / Tema ===== */
:root{
  color-scheme: light dark;

  --fs-base: clamp(18px, 1.2vw + 14px, 22px);
  --space: clamp(12px, 1vw + 8px, 18px);
  --col-width: 420px;

  --font: "Montserrat", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;

  --bg:#f8fbf4; --fg:#1b1b1b; --muted:#50380b;
  --card:#ffffff; --border:#e5e7eb;

  --accent:#99cd68; --accent-2:#5fcbe0; --warning:#e8b75b; --focus: var(--accent-2);

  --btn-primary-bg: var(--accent);  --btn-primary-fg:#08340f;
  --btn-sec-bg: var(--accent-2);    --btn-sec-fg:#072a32;

  --verde:#9edc7a; --rojo:#f28b82; --azul:#7ecdf2; --amarillo:#f7d774;

  /* FAB theme-aware */
  --fab-bg-light: #1f2729;
  --fab-fg-light: #eef8ff;
  --fab-shadow-light: 0 10px 20px rgba(0,0,0,.18), 0 2px 4px rgba(0,0,0,.12);

  --fab-bg-dark: var(--accent-2);
  --fab-fg-dark: #05232a;
  --fab-shadow-dark: 0 8px 18px rgba(0,0,0,.55), 0 0 0 1px rgba(255,255,255,.05) inset;

  --fab-ring: var(--accent-2);
}
html[data-theme="dark"]{
  --bg:#0e0e0e; --fg:#f2f2f2; --muted:#cfcfcf;
  --card:#171717; --border:#2a2a2a;
  --btn-primary-bg: var(--accent); --btn-primary-fg:#0a0a0a;
  --btn-sec-bg: var(--accent-2);   --btn-sec-fg:#0a0a0a;
}

/* ===== Base ===== */
*{ box-sizing:border-box }
html,body{ height:100% }
html{ -webkit-text-size-adjust:100%; text-size-adjust:100% }
body{
  margin:0; background:var(--bg); color:var(--fg);
  font-family:var(--font); font-size:var(--fs-base);
  line-height:1.7; letter-spacing:.15px;
  -webkit-tap-highlight-color: transparent;
  padding-bottom: calc(env(safe-area-inset-bottom,0) + var(--space));
}
.wrap{ max-width:900px; width:min(900px, calc(100% - 2*var(--space))); margin:0 auto; padding:var(--space) }

/* ===== Columna central ===== */
.header, .header .intro, .controles, .tablero, .estado{
  max-width: var(--col-width);
  margin-left:auto; margin-right:auto; width:100%; text-align:center;
}
.header h1{ font-size:clamp(1.8rem, 2vw + 1rem, 2.4rem); margin:.5rem 0 .3rem; font-weight:900 }
.header .intro{ margin:0 0 var(--space); font-size:1.05rem; line-height:1.6; opacity:.95 }

/* ===== Controles ===== */
.controles{
  display:grid; gap:1rem; margin:1rem 0 1.2rem;
  grid-template-columns: 1fr; grid-template-areas: "vel" "actions";
}
.controles .control{ display:grid; gap:.5rem }
.controles .control:nth-child(1){ grid-area:vel }
.controles .control--actions{ grid-area:actions; display:grid; gap:.8rem }
label{ display:block; font-weight:800; opacity:.98 }
select{
  appearance:none; width:100%;
  background:var(--card); color:var(--fg); border:1px solid var(--border);
  padding:.8rem 1rem; border-radius:.8rem; font-size:1.05rem;
  background-image:url("data:image/svg+xml;utf8,<svg fill='currentColor' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'><path d='M5.5 7l4.5 5 4.5-5z'/></svg>");
  background-repeat:no-repeat; background-position:right 1rem center; background-size:1rem; padding-right:2.4rem;
}
select:focus-visible{ outline:3px solid var(--focus); outline-offset:3px; border-color:var(--focus) }

/* ===== Botones ===== */
.btn{
  border:0; border-radius:16px; cursor:pointer; font-weight:800;
  padding:1rem 1.2rem; min-height:52px; font-size:1.05rem;
  transition: transform .08s ease, filter .15s ease, box-shadow .15s ease, background-color .15s ease, color .15s ease;
  touch-action:manipulation; width:100%;
}
.btn:hover{ filter:brightness(1.04); transform:translateY(-1px) }
.btn:focus-visible{ outline:3px solid var(--focus); outline-offset:3px }
.btn.principal{ background:var(--btn-primary-bg); color:var(--btn-primary-fg) }
.btn.secundario{ background:var(--btn-sec-bg);  color:var(--btn-sec-fg) }
.btn:disabled, .btn[aria-disabled="true"]{ opacity:.55; cursor:not-allowed; filter:none; transform:none; box-shadow:none }
.btn[aria-pressed="true"]{ box-shadow:inset 0 2px 6px rgba(0,0,0,.18); filter:brightness(0.98) }
a.btn, a.btn:link, a.btn:visited, a.btn:hover, a.btn:focus, a.btn:active{ text-decoration:none; color:inherit }

/* ===== FABs ===== */
.fab-stack{
  position:fixed; right:max(12px, env(safe-area-inset-right,0)); top:max(12px, env(safe-area-inset-top,0));
  display:grid; gap:12px; z-index:20;
}
.fab{
  border:0; width:46px; height:46px; border-radius:50%;
  display:grid; place-items:center; cursor:pointer; font-weight:900; font-size:1.1rem;
  transition: transform .08s ease, filter .15s ease, box-shadow .15s ease, background-color .15s ease, color .15s ease;
}
/* Light */
html[data-theme="light"] .fab{
  background: var(--fab-bg-light);
  color: var(--fab-fg-light);
  box-shadow: var(--fab-shadow-light);
  text-shadow: 0 1px 0 rgba(0,0,0,.35);
}
/* Dark */
html[data-theme="dark"] .fab{
  background: var(--fab-bg-dark);
  color: var(--fab-fg-dark);
  box-shadow: var(--fab-shadow-dark);
  text-shadow: none;
}
.fab:hover{ transform: translateY(-1px); filter: brightness(1.04) }
.fab:focus-visible{ outline:3px solid var(--fab-ring); outline-offset:3px }
.fab[aria-pressed="true"]{ box-shadow: 0 0 0 3px var(--fab-ring), 0 8px 18px rgba(0,0,0,.35) }

/* FABs compactos mientras se juega (móvil) */
@media (max-width: 640px){
  body.fab-compact .fab-stack{ right:8px; top:8px; gap:10px; }
  body.fab-compact .fab{ width:38px; height:38px; box-shadow:0 6px 14px rgba(0,0,0,.18); opacity:.85; }
  body.fab-compact .fab:hover, body.fab-compact .fab:focus-visible{ opacity:1; }
}

/* ===== Modal usable ===== */
.modal{
  display:none; position:fixed; inset:0; background:rgba(0,0,0,.6); z-index:30;
  overflow:auto; -webkit-overflow-scrolling:touch;
}
.modal[aria-hidden="false"]{ display:block }
.modal-card{
  position:relative;
  max-width:min(540px, 100% - 2*var(--space));
  margin: min(8vh, 56px) auto;
  max-height: calc(100vh - 2*min(8vh, 56px));
  overflow:auto; scrollbar-gutter:stable both-edges; overscroll-behavior:contain;
  background:var(--card); color:var(--fg);
  padding:clamp(16px, 2vw, 24px);
  border-radius:14px; border:1px solid var(--border);
  box-shadow:0 4px 20px rgba(0,0,0,.25);
}
.modal-close{
  position:absolute; top:8px; right:8px; width:36px; height:36px; border-radius:50%;
  display:grid; place-items:center; background:transparent; border:0; cursor:pointer;
  font-size:20px; line-height:1; color:var(--fg); opacity:.75;
}
.modal-close:hover{ opacity:1 }
.modal-close:focus-visible{ outline:3px solid var(--focus); outline-offset:3px }
.modal-actions{
  position:sticky; bottom:0;
  background:linear-gradient(to top, color-mix(in oklab, var(--card) 96%, transparent), transparent 70%);
  margin-top:12px; padding-top:12px;
  display:flex; gap:10px; justify-content:flex-end;
}
/* impedir scroll de fondo */
body.no-scroll{ overflow:hidden }

/* ===== Tablero ===== */
.tablero{
  display:grid; gap:14px; margin:1.5rem auto; max-width:var(--col-width);
  grid-template-columns:1fr 1fr;
}
.color{
  position:relative; width:100%; aspect-ratio:1/1; border-radius:20px;
  border:4px solid var(--border);
  box-shadow:0 2px 10px rgba(0,0,0,.12) inset, 0 2px 8px rgba(0,0,0,.08);
  opacity:.96; cursor:pointer;
  transition: transform .08s ease, opacity .12s ease, filter .12s ease, box-shadow .12s ease;
  min-width:120px; flex:0 0 auto;
}
.color:focus-visible{ outline:4px solid var(--focus); outline-offset:3px }
.color.verde{ background:var(--verde) } .color.rojo{ background:var(--rojo) }
.color.azul{ background:var(--azul) } .color.amarillo{ background:var(--amarillo) }
.color.activo, .color.is-play{
  transform:scale(1.07); opacity:1; filter:brightness(1.22) saturate(1.15);
  box-shadow:0 0 0 6px rgba(255,255,255,.90), 0 0 18px rgba(0,0,0,.25);
  outline:5px solid rgba(255,255,255,.90); outline-offset:2px; animation:padPulse .16s ease;
}
@keyframes padPulse{ from{ transform:scale(1.00) } to{ transform:scale(1.07) } }
.tablero.error .color{ filter:grayscale(.35) opacity(.8) }
.tablero.error .color.activo{ filter:none }

/* ===== Progreso ===== */
.progresoBar{ height:10px; background:color-mix(in oklab, var(--border) 80%, transparent); border-radius:999px; overflow:hidden; margin-top:.4rem }
#pbFill{ height:100%; width:0%; background:linear-gradient(90deg, var(--btn-primary-bg), var(--btn-sec-bg)); transition:width .25s ease }

/* ===== Modo daltónico ===== */
[data-colorblind="on"] .color{ position:relative }
[data-colorblind="on"] .color::after{
  content:""; position:absolute; inset:0; display:grid; place-items:center;
  font-size:clamp(28px, 9vw, 60px); font-weight:900; line-height:1; pointer-events:none;
  color:#111; text-shadow:0 0 4px rgba(255,255,255,.95), 0 0 2px rgba(0,0,0,.65); mix-blend-mode:multiply;
}
html[data-theme="light"][data-colorblind="on"] .color::after{
  color:#fff; text-shadow:0 0 4px rgba(0,0,0,.9), 0 0 2px rgba(0,0,0,.9); mix-blend-mode:normal;
}
html[data-theme="dark"][data-colorblind="on"] .color::after{ mix-blend-mode:screen }
[data-colorblind="on"] .color.rojo::after{ content:"▲" }
[data-colorblind="on"] .color.verde::after{ content:"●" }
[data-colorblind="on"] .color.azul::after{ content:"■" }
[data-colorblind="on"] .color.amarillo::after{ content:"◆" }

/* ===== Footer ===== */
.mini-credit{ margin-top:.8rem; padding:.6rem 0; border-top:1px solid var(--border); font-size:.85em; line-height:1.35; color:var(--muted) }
.mini-credit a{ color:inherit; text-decoration:underline; font-weight:700 }
.mini-label{ font-weight:900; color:var(--fg) }

/* ===== Accesibilidad ===== */
.visually-hidden{
  position:absolute !important;
  width:1px; height:1px; margin:-1px; padding:0;
  overflow:hidden; clip:rect(0 0 0 0); white-space:nowrap; border:0;
}
.skip{ position:absolute; left:-9999px; top:auto }
.skip:focus{
  left:max(12px, env(safe-area-inset-left,0)); top:max(12px, env(safe-area-inset-top,0));
  background:var(--btn-primary-bg); color:var(--btn-primary-fg); padding:8px 10px; border-radius:8px; z-index:1000;
}
@media (prefers-reduced-motion: reduce){
  *{ scroll-behavior:auto }
  .color, .btn, #pbFill{ transition:none !important }
  .color.activo, .color.is-play{ animation:none !important }
}
@media (prefers-contrast: more){
  :root{ --border:#4b5563 }
  .btn.principal{ box-shadow:inset 0 0 0 3px rgba(0,0,0,.18) }
  .btn:focus-visible{ outline-width:4px }
  #pbFill{ background:var(--btn-primary-bg) }
}
@supports not (color: color-mix(in oklab, red 50%, white)){
  .progresoBar{ background:#e9edf0 }
  #pbFill{ background:var(--btn-primary-bg) }
}

/* Normalizar botones y anchors .btn */
.btn{
  display: block;            /* <a> y <button> misma caja */
  width: 100%;
}

/* Asegurar colores también para <a> */
a.btn.principal{  background: var(--btn-primary-bg); color: var(--btn-primary-fg); }
a.btn.secundario{ background: var(--btn-sec-bg);     color: var(--btn-sec-fg); }

/* Evitar subrayado y estados raros en <a> */
a.btn, a.btn:link, a.btn:visited, a.btn:hover, a.btn:focus, a.btn:active{
  text-decoration: none;
  color: inherit;
}

/* iOS/Safari a veces mantiene apariencia nativa */
button.btn, a.btn{
  -webkit-appearance: none;
  appearance: none;
}

/* Respetar SIEMPRE el atributo [hidden] */
[hidden]{
  display: none !important;
}
